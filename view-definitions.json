{
    "language": "javascript", 
    "views": {
        "all": {
            "map": "function(doc) { if (doc.type == 'activity')  emit(doc._id, doc) }"
        }, 
		"all_byuser": {
			"map": "function(doc) { if (doc.type == 'activity')  emit([doc.user, new Date(parseInt(doc.updatedAt)).toDateString(), doc.category, doc.action, doc.quantity, doc.units],null) }"
		},
        "by_usercategory": {
            "map": "function(doc) { if (doc.type == 'activity')  emit([doc.user,doc.category],{action: doc.action, date: parseInt(doc.updatedAt), qty: doc.quantity, units: doc.units}) }"
        }, 
        "distinct_usercategory": {
            "map": "function(doc) { if (doc.type == 'activity') emit([doc.user,doc.category], null) }", 
            "reduce": "function(keys,values) { emit(null) }"
        }, 
        "user-bydate": {
            "map": "function(doc) { if (doc.type == 'activity')  emit([doc.user, doc.updatedAt], doc) }"
        },
		"distinct_useractioncategory": {
			"map": "function(doc) { if (doc.type == 'activity') emit([doc.user,doc.action.trim(),doc.category.trim()],null) }",
			"reduce": "function(keys,values) { emit(null) }"
		},
		"today": {
	       "map": "function(doc) { if (doc.type=='activity') { var millisperday = 86400000; var e = new Date(); e.setHours(0); e.setMinutes(0); e.setSeconds(0); e.setMilliseconds(0); var t=e.getTime(); var ts = parseInt(doc.updatedAt); if(ts > t) { emit([doc.category, doc.action],doc) }}}"
	    },
		"last_five_days": {
	       "map": "function(doc) { if (doc.type=='activity') { var millisperday = 86400000; var e = new Date(); e.setHours(0); e.setMinutes(0); e.setSeconds(0); e.setMilliseconds(0); var t=e.getTime(); var s = t - (5 * millisperday); var ts = parseInt(doc.updatedAt); if(ts > s && ts < t) { emit([doc.category, doc.action],doc) }}}",
	       "reduce": "function(keys,values,rereduce) { if(rereduce==false) {var retval = {}; values.forEach(function(val){if(retval[val.category]==undefined) {retval[val.category]={};} if(retval[val.category][val.action]==undefined) {retval[val.category][val.action]=[];} retval[val.category][val.action].push(val.quantity);retval.unit=val.units});} else {retval={};} return(retval);}"
	   }
    }
}
