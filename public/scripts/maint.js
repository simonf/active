// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var SFLocals;
    $('#logged-in-username').append(CookieChecker.getUserName());
    SFLocals = {
      actions: [],
      categories: [],
      refreshLookups: function() {
        SFLocals.actions = [];
        SFLocals.categories = [];
        SimpleClient.fetchCategoriesAndActionsForUser(function(dat) {
          var row, _i, _len;
          for (_i = 0, _len = dat.length; _i < _len; _i++) {
            row = dat[_i];
            if (SFLocals.actions.indexOf(row.key[1]) === -1) {
              SFLocals.actions.push(row.key[1]);
            }
            if (SFLocals.categories.indexOf(row.key[2]) === -1) {
              SFLocals.categories.push(row.key[2]);
            }
          }
          SFLocals.popCategory();
          return SFLocals.popActivity();
        });
      },
      popCategory: function() {
        var cat, _i, _len, _ref, _results;
        $("#category-from").empty();
        _ref = SFLocals.categories;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          cat = _ref[_i];
          _results.push($("#category-from").append("<option>" + cat + "</option>"));
        }
        return _results;
      },
      popActivity: function() {
        var act, _i, _len, _ref, _results;
        $("#activity-from").empty();
        _ref = SFLocals.actions;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          act = _ref[_i];
          _results.push($("#activity-from").append("<option>" + act + "</option>"));
        }
        return _results;
      }
    };
    SFLocals.refreshLookups();
    $('#cat-button').on('click', function() {
      var url, vf, vt;
      vf = $('#category-from').val();
      vt = $('#category-to').val();
      url = "/changeCategory/" + vf + "/" + vt;
      return $.get(url, function(dat, stat) {
        var msg;
        if (stat === 'success') {
          msg = "<p>Updated " + dat.matchcnt + " records from category " + vf + " to " + vt + " with " + dat.errcnt + " errors</p>";
        } else {
          msg = "<p>Error: " + dat.errmsg;
        }
        $("#cat-msg").append(msg);
        return SFLocals.refreshLookups();
      }, "json");
    });
    $('#act-button').on('click', function() {
      var url, vf, vt;
      vf = $('#activity-from').val();
      vt = $('#activity-to').val();
      url = "/changeActivity/" + vf + "/" + vt;
      return $.get(url, function(dat, stat) {
        var msg;
        if (stat === 'success') {
          msg = "<p>Updated " + dat.matchcnt + " records from action " + vf + " to " + vt + " with " + dat.errcnt + " errors</p>";
        } else {
          msg = "<p>Error: " + dat.errmsg;
        }
        $("#act-msg").append(msg);
        return SFLocals.refreshLookups();
      }, "json");
    });
  });

}).call(this);
